# 垂直アライメント機能

## 概要

セル内の文字の垂直方向（上下）配置を指定できる機能。
既存の水平方向（左右）配置と組み合わせて使用可能。

---

## 1. 背景

### 課題
- 従来のxlmakeでは水平方向のアライメント（left/center/right）のみ対応
- 垂直方向は常に中央（middle）に固定されていた
- 特にマージされたセルでは、上寄せが望ましいケースが多い

### 解決策
- `align`プロパティを拡張して複合形式に対応
- マージされたセルは自動で上寄せに

---

## 2. 仕様

### 2.1 AlignType

#### 水平方向のみ（後方互換）
```typescript
align: "left" | "center" | "right"
```
- 垂直方向はデフォルトで`middle`（中央）

#### 複合形式（垂直-水平）
```typescript
align: "top-left" | "top-center" | "top-right"
     | "middle-left" | "middle-center" | "middle-right"
     | "bottom-left" | "bottom-center" | "bottom-right"
```
- 垂直方向と水平方向を同時に指定

### 2.2 使用例

```typescript
// 既存の使い方（後方互換）
{ key: "name", label: "名前", style: { align: "left" } }

// 新しい使い方（垂直アライメント指定）
{ key: "desc", label: "説明", style: { align: "top-left" } }
{ key: "note", label: "備考", style: { align: "bottom-center" } }
```

### 2.3 マージ時の自動上寄せ

`mergeSameValues`でマージされたセルは、自動的に上寄せ（`vertical: "top"`）になる。

```typescript
xlmake()
  .table({
    mergeSameValues: true,
    columns: [
      { key: "category", label: "カテゴリ" },  // マージされると自動でtop
      { key: "name", label: "商品名" },
    ],
    data: [...],
  });
```

---

## 3. 技術詳細

### 3.1 変換ロジック

```typescript
function convertAlignment(align: AlignType): Partial<Alignment> {
  // 複合形式（"top-left" など）の場合
  if (align.includes("-")) {
    const [vertical, horizontal] = align.split("-");
    return { horizontal, vertical };
  }

  // 既存形式（"left", "center", "right"）の場合
  return {
    horizontal: align,
    vertical: "middle",  // 後方互換
  };
}
```

### 3.2 読み取り時の変換

- `vertical`が`middle`以外の場合: 複合形式（`top-left`など）で返す
- `vertical`が`middle`または未設定の場合: 従来形式（`left`など）で返す

---

## 4. 関連ファイル

| ファイル | 役割 |
|---------|------|
| `src/types/style.ts` | `AlignType`型定義 |
| `src/schemas/style.ts` | Zodスキーマ |
| `src/styles/converter.ts` | ExcelJS変換 |
| `src/engine/sheet-writer.ts` | マージ時の自動上寄せ |
| `src/reader/cell-reader.ts` | 読み取り対応 |

---

## 5. 関連ドキュメント

- [xlmake 機能仕様書](./2026-01-11_xlmake-feature-spec.md)
- [xlmake API設計書](./2026-01-11_xlmake-api-design.md)
